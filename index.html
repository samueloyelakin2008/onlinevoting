<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Official Voting Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  :root {
    --primary: #0052cc;
    --secondary: #2684ff;
    --accent: #00b8d9;
    --dark: #172b4d;
    --gray-light: #f4f5f7;
    --gray-medium: #6b778c;
    --danger: #de350b;
    --white: #fff;
    --shadow: rgba(9,30,66,.25);
  }
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Poppins', sans-serif;
    background: var(--gray-light);
    margin: 0;
    color: var(--dark);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  header {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: var(--white);
    padding: 3rem 1rem;
    text-align: center;
    box-shadow: 0 4px 15px var(--shadow);
  }
  header h1 {
    font-weight: 700;
    font-size: 3rem;
    margin-bottom: 0.3rem;
    letter-spacing: 0.1em;
  }
  header p {
    font-weight: 500;
    font-size: 1.2rem;
    opacity: 0.85;
  }
  main.container {
    max-width: 1100px;
    margin: 2rem auto 4rem;
    padding: 0 1rem;
    flex-grow: 1;
  }
  .candidates-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
    gap: 2rem;
    animation: fadeInUp 0.8s ease forwards;
  }
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .candidate-card {
    background: var(--white);
    border-radius: 14px;
    box-shadow: 0 8px 20px var(--shadow);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
    user-select: none;
    border: 3px solid transparent;
  }
  .candidate-card:hover, .candidate-card:focus-within {
    transform: translateY(-6px);
    box-shadow: 0 15px 35px rgba(0, 82, 204, 0.3);
    outline: none;
  }
  .candidate-card.selected {
    border-color: var(--accent);
    box-shadow: 0 15px 35px rgba(0, 184, 217, 0.6);
    transform: translateY(-6px);
  }
  .candidate-image {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-bottom: 1px solid var(--gray-light);
  }
  .candidate-info {
    padding: 1.5rem 1.8rem;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }
  .candidate-name {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.6rem;
    color: var(--primary);
  }
  .candidate-description {
    flex-grow: 1;
    font-size: 1rem;
    color: var(--gray-medium);
    margin-bottom: 1.5rem;
    line-height: 1.4;
  }
  /* Pay Now Button */
  #pay-now-btn {
    margin: 2rem auto 0;
    display: block;
    background: var(--primary);
    color: var(--white);
    font-weight: 700;
    font-size: 1.3rem;
    padding: 16px 30px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    opacity: 0.5;
    pointer-events: none;
    transition: opacity 0.3s ease, background 0.3s ease;
    max-width: 320px;
    width: 90%;
    user-select: none;
    box-shadow: 0 6px 15px rgba(0,82,204,0.3);
  }
  #pay-now-btn.enabled {
    opacity: 1;
    pointer-events: auto;
  }
  #pay-now-btn.enabled:hover {
    background: var(--accent);
    box-shadow: 0 8px 20px rgba(0,184,217,0.6);
  }
  /* Paystack badge */
  #paystack-badge {
    margin: 0.8rem auto 0;
    max-width: 320px;
    width: 90%;
    text-align: center;
    font-size: 0.9rem;
    color: var(--gray-medium);
    font-weight: 600;
    user-select: none;
  }
  #paystack-badge img {
    vertical-align: middle;
    height: 20px;
    margin-left: 6px;
  }
  /* Modal styles */
  .modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .modal-overlay.active {
    display: flex;
    opacity: 1;
  }
  .modal {
    background: var(--white);
    padding: 2rem 2.5rem;
    border-radius: 12px;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 10px 30px var(--shadow);
    text-align: center;
    position: relative;
    transform: translateY(-30px);
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }
  .modal-overlay.active .modal {
    transform: translateY(0);
    opacity: 1;
  }
  .modal h2 {
    margin-bottom: 1rem;
    color: var(--primary);
    font-weight: 700;
  }
  .modal label {
    display: block;
    text-align: left;
    margin-bottom: 0.3rem;
    font-weight: 600;
    color: var(--dark);
  }
  .modal input[type="email"] {
    width: 100%;
    padding: 0.7rem 1rem;
    font-size: 1rem;
    border-radius: 8px;
    border: 1px solid #ccc;
    margin-bottom: 1.2rem;
    outline-offset: 2px;
    outline-color: var(--primary);
    transition: box-shadow 0.3s ease;
  }
  .modal input[type="email"]:focus {
    box-shadow: 0 0 5px 2px var(--primary);
    border-color: var(--primary);
    outline: none;
  }
  .modal .btn-group {
    display: flex;
    justify-content: space-between;
  }
  .modal button {
    flex: 1;
    padding: 0.8rem 0;
    font-weight: 700;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .modal button.submit-btn {
    background: var(--primary);
    color: var(--white);
    margin-right: 0.5rem;
  }
  .modal button.submit-btn:hover {
    background: var(--accent);
  }
  .modal button.cancel-btn {
    background: #ccc;
    color: var(--dark);
  }
  .modal button.cancel-btn:hover {
    background: #bbb;
  }
  .modal .error-msg {
    color: var(--danger);
    font-weight: 600;
    margin-bottom: 1rem;
    display: none;
  }
  /* Footer */
  footer.site-footer {
    background: var(--dark);
    color: var(--gray-light);
    padding: 2.5rem 1rem;
    text-align: center;
    font-size: 0.9rem;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
  }
  footer.site-footer a {
    color: var(--accent);
    text-decoration: none;
    font-weight: 600;
    margin: 0 0.5rem;
    transition: color 0.3s ease;
  }
  footer.site-footer a:hover,
  footer.site-footer a:focus {
    color: var(--primary);
    outline: none;
  }
  footer.site-footer .footer-links {
    margin-bottom: 1rem;
  }
  @media (max-width: 600px) {
    .candidate-card {
      flex-direction: column;
    }
    footer.site-footer .footer-links {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
  }
</style>
</head>
<body>
<header>
  <h1>Official Voting Platform</h1>
  <p>Cast your vote securely for ₦100 per candidate</p>
</header>

<main class="container">
  <div class="candidates-grid" id="candidates-container"></div>
  <button id="pay-now-btn" type="button" disabled>Pay Now</button>
  <div id="paystack-badge" aria-label="Powered by Paystack">
    Powered by Paystack
  </div>
</main>

<footer class="site-footer" role="contentinfo">
  <div class="footer-links" aria-label="Footer navigation">
    <a href="#" tabindex="0">Privacy Policy</a>
    <a href="#" tabindex="0">Terms of Service</a>
    <a href="#" tabindex="0">Contact Us</a>
  </div>
  <div>© 2025 Official Voting Platform. All rights reserved.</div>
</footer>

<!-- Email Modal -->
<div class="modal-overlay" id="email-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
  <div class="modal">
    <h2 id="modal-title">Enter Your Email</h2>
    <div class="error-msg" id="modal-error"></div>
    <label for="email-input">Email Address</label>
    <input type="email" id="email-input" placeholder="you@example.com" autocomplete="email" />
    <div class="btn-group">
      <button class="submit-btn" id="modal-submit" type="button">Submit</button>
      <button class="cancel-btn" id="modal-cancel" type="button">Cancel</button>
    </div>
  </div>
</div>

<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
  const candidates = [
    { id: 1, name: "Adeola Johnson", description: "Education reform advocate with 10+ years experience in policy development.", image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=400&q=80" },
    { id: 2, name: "Chinedu Okoro", description: "Tech entrepreneur focused on digital transformation in public services.", image: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=400&q=80" },
    { id: 3, name: "Fatima Ahmed", description: "Healthcare specialist pushing for improved rural medical facilities.", image: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?auto=format&fit=crop&w=400&q=80" },
    { id: 4, name: "Emeka Nwankwo", description: "Infrastructure development expert with focus on sustainable energy.", image: "https://images.unsplash.com/photo-1560250097-0b93528c311a?auto=format&fit=crop&w=400&q=80" },
    { id: 5, name: "Bisi Adeyemi", description: "Agricultural innovation champion supporting small-scale farmers.", image: "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?auto=format&fit=crop&w=400&q=80" },
    { id: 6, name: "Tunde Okafor", description: "Security specialist with innovative community policing strategies.", image: "https://images.unsplash.com/photo-1564564321837-a57b7070ac4f?auto=format&fit=crop&w=400&q=80" },
    { id: 7, name: "Ngozi Eze", description: "Youth empowerment advocate creating job opportunities in tech.", image: "https://images.unsplash.com/photo-1573497019940-1c28c88b4f3e?auto=format&fit=crop&w=400&q=80" },
    { id: 8, name: "Kunle Adebayo", description: "Environmental scientist promoting sustainable waste management.", image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=400&q=80" },
    { id: 9, name: "Aisha Mohammed", description: "Financial inclusion expert developing microcredit solutions.", image: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=400&q=80" },
    { id: 10, name: "Segun Olawale", description: "Transportation engineer redesigning urban mobility systems.", image: "https://images.unsplash.com/photo-1508341591423-4347099e1f19?auto=format&fit=crop&w=400&q=80" }
  ];

  const container = document.getElementById('candidates-container');
  const payNowBtn = document.getElementById('pay-now-btn');
  const modalOverlay = document.getElementById('email-modal');
  const modalError = document.getElementById('modal-error');
  const emailInput = document.getElementById('email-input');
  const modalSubmit = document.getElementById('modal-submit');
  const modalCancel = document.getElementById('modal-cancel');

  let selectedCandidateIds = new Set();

  function renderCandidates() {
    container.innerHTML = '';
    candidates.forEach(c => {
      const card = document.createElement('div');
      card.className = 'candidate-card';
      card.tabIndex = 0;
      card.dataset.id = c.id;
      card.innerHTML = `
        <img src="${c.image}" alt="${c.name}" class="candidate-image" />
        <div class="candidate-info">
          <h3 class="candidate-name">${c.name}</h3>
          <p class="candidate-description">${c.description}</p>
        </div>
      `;
      card.addEventListener('click', () => {
        toggleSelection(c.id, card);
      });
      container.appendChild(card);
    });
  }

  function toggleSelection(id, card) {
    if (selectedCandidateIds.has(id)) {
      selectedCandidateIds.delete(id);
      card.classList.remove('selected');
    } else {
      selectedCandidateIds.add(id);
      card.classList.add('selected');
    }
    updatePayNowButton();
  }

  function updatePayNowButton() {
    if (selectedCandidateIds.size > 0) {
      payNowBtn.disabled = false;
      payNowBtn.classList.add('enabled');
      payNowBtn.textContent = `Pay Now (₦${selectedCandidateIds.size * 100})`;
    } else {
      payNowBtn.disabled = true;
      payNowBtn.classList.remove('enabled');
      payNowBtn.textContent = 'Pay Now';
    }
  }

  function openEmailModal() {
    modalError.style.display = 'none';
    emailInput.value = '';
    modalOverlay.classList.add('active');
    setTimeout(() => emailInput.focus(), 150);
  }

  function closeEmailModal() {
    modalOverlay.classList.remove('active');
  }

  function validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  function initiatePayment(email) {
    if (selectedCandidateIds.size === 0) {
      alert('Please select at least one candidate.');
      return;
    }
    const amount = selectedCandidateIds.size * 100 * 100; // kobo
    const candidateIdsArray = Array.from(selectedCandidateIds);
    const candidateNamesArray = candidateIdsArray.map(id => candidates.find(c => c.id === id).name);

    const handler = PaystackPop.setup({
      key: 'pk_test_3eb3a7a1984e449ded1f6d6447d0789a1f0758f7',
      email: email,
      amount: amount,
      currency: 'NGN',
      ref: '' + Math.floor((Math.random() * 1000000000) + 1),
      metadata: {
        candidate_ids: candidateIdsArray,
        candidate_names: candidateNamesArray
      },
      callback: function(response) {
        sendVoteToGoogleScript(candidateIdsArray, candidateNamesArray, response.reference, email);
      },
      onClose: function() {
        alert('Payment window closed.');
      }
    });
    handler.openIframe();
  }

  function sendVoteToGoogleScript(candidateIds, candidateNames, paymentRef, email) {
    const scriptURL = 'https://script.google.com/macros/s/AKfycbz1AS163_TXlxjjbmU46cPU4OCRQYLL2XBMHbH4mydym8uNnkkVfcFSY012dnZjUIgPnA/exec';

    const userAgent = navigator.userAgent;

    const params = new URLSearchParams({
      candidateIds: JSON.stringify(candidateIds),
      candidateNames: JSON.stringify(candidateNames),
      paymentRef,
      email,
      timestamp: new Date().toISOString(),
      userAgent
    });

    fetch(`${scriptURL}?${params.toString()}`)
      .then(() => {
        alert('Vote recorded successfully!');
        selectedCandidateIds.clear();
        document.querySelectorAll('.candidate-card.selected').forEach(card => card.classList.remove('selected'));
        updatePayNowButton();
      })
      .catch(() => {
        alert('Error recording vote. Please try again.');
      });
  }

  modalSubmit.addEventListener('click', () => {
    const email = emailInput.value.trim();
    if (!validateEmail(email)) {
      modalError.textContent = 'Please enter a valid email address.';
      modalError.style.display = 'block';
      emailInput.focus();
      return;
    }
    modalError.style.display = 'none';
    closeEmailModal();
    initiatePayment(email);
  });

  modalCancel.addEventListener('click', closeEmailModal);

  modalOverlay.addEventListener('click', (e) => {
    if (e.target === modalOverlay) closeEmailModal();
  });

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modalOverlay.classList.contains('active')) {
      closeEmailModal();
    }
  });

  payNowBtn.addEventListener('click', () => {
    openEmailModal();
  });

  document.addEventListener('DOMContentLoaded', () => {
    renderCandidates();
    updatePayNowButton();
  });
</script>
</body>
</html>
